---
title: Linux 
published: 2025-12-12
description: 'linux备忘'
image: ''
tags: ['部署']
category: '备忘'
draft: false
lang: ''
---
# 权限管理
## 命令
```bash
chmod <权限数> <文件路径>
```
## 基本权限数字
- 4 = 读 (Read) = `r`
- 2 = 写 (Write) = `w`
- 1 = 执行 (Execute) = `x`

## 权限组合运算
```bash
# 举例：
rwx = 4+2+1 = 7    # 读写执行
rw- = 4+2+0 = 6    # 读写
r-x = 4+0+1 = 5    # 读执行
r-- = 4+0+0 = 4    # 只读
-wx = 0+2+1 = 3    # 写执行
-w- = 0+2+0 = 2    # 只写
--x = 0+0+1 = 1    # 只执行
--- = 0+0+0 = 0    # 无权限
```

## 三位数权限表示
`chmod` 命令中的三位数字分别代表：
```
用户(owner)   组(group)   其他用户(other)
    ↓            ↓            ↓
   abc
```

例如：
```bash
chmod 765 file.txt
# 7(4+2+1)=rwx 所有者：读写执行
# 6(4+2+0)=rw- 组用户：读写  
# 5(4+0+1)=r-x 其他用户：读执行
ls -l
#可以查出文件权限，比如这个就是644
-rw-r--r-- 1 root root 3444 Jul  6  2023 <文件名>
```


# Systemd 服务管理
`服务文件路径`：/etc/systemd/system/
## 1. `sudo systemctl daemon-reload`
**作用**：重新加载 systemd 服务配置文件
**使用时机**：当你修改了 `.service` 文件后必须执行
```bash
# 比如你修改了 /etc/systemd/system/flaskapp.service
sudo nano /etc/systemd/system/flaskapp.service
sudo systemctl daemon-reload  # 让 systemd 知道配置变了
```

## 2. `sudo systemctl enable <服务名>`
**作用**：启用服务，让它在系统启动时自动运行
```bash
# 启用服务（开机自启）
sudo systemctl enable <服务名>

# 禁用服务（不开机自启）
sudo systemctl disable <服务名>
```

## 3. `sudo systemctl start <服务名>`
**作用**：立即启动服务
```bash
# 启动服务
sudo systemctl start <服务名>

# 停止服务
sudo systemctl stop <服务名>

# 重启服务
sudo systemctl restart <服务名>
```

## 4. `sudo systemctl status <服务名>`
**作用**：查看服务的运行状态和日志
```bash
# 查看状态
sudo systemctl status <服务名>

# 查看详细日志
sudo journalctl -u <服务名> -f
```

## 第一次设置服务时：
```bash
# 1. 创建服务文件
sudo vim /etc/systemd/system/flaskapp.service

# 2. 重新加载配置（让 systemd 认识新服务）
sudo systemctl daemon-reload

# 3. 启用服务（开机自启）
sudo systemctl enable flaskapp

# 4. 启动服务
sudo systemctl start flaskapp

# 5. 检查状态
sudo systemctl status flaskapp
```

## 日常管理：
```bash
# 查看状态
sudo systemctl status flaskapp

# 重启服务（部署新代码后）
sudo systemctl restart flaskapp

# 停止服务
sudo systemctl stop flaskapp

# 查看日志
sudo journalctl -u flaskapp -f
```

## 服务配置文件
```ini
# /etc/systemd/system/flaskapp.service
[Unit]
Description=Flask Backend Application
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/root/flask_backend
Environment=PATH=/root/flask_backend/.venv/bin
ExecStart=/root/flask_backend/.venv/bin/gunicorn -w 2 -b 0.0.0.0:5000 "flaskr:create_app()"
Restart=always

[Install]
WantedBy=multi-user.target
```

# 进程管理
父进程启动的子进程，会在父进程断开后，子进程也会自动关闭。
所以用ssh启动的想长期开启的服务将会在ssh断开后停止。
可以使用screen，tmux，nohup，systemd，docker来守护进程，这样的话启动的服务将不在ssh的bash进程下了。
## 常用进程管理命令
```bash
ps #展示当前用户的进程
ps aux #所有用户的进程
ps auxf #进程树
```
| 信号 | 数字代号 | 命令示例 | 行为 | 适用场景 |
|------|---------|----------|------|----------|
| **SIGTERM** (终止) | **15** (默认) | `kill -15 <PID>` | **优雅终止**，允许进程清理后退出 | **首选方式**，正常关闭进程 |
| **SIGKILL** (强制终止) | **9** | `kill -9 <PID>` | **强制立即终止**，不给清理机会 | 进程卡死、不响应 SIGTERM 时 |
| **SIGINT** (中断) | **2** | `kill -2 <PID>` | 模拟 Ctrl+C，通常优雅终止 | 交互式程序中断 |
| **SIGSTOP** (暂停) | **19** | `kill -19 <PID>` | 暂停进程（可恢复） | 临时挂起进程 |
```bash
kill [信号] <PID>
```
